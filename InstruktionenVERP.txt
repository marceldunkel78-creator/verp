
Backend abhängigkeiten:
cd backend
python -m venv venv
.\venv\Scripts\Activate
pip install -r requirements.txt

migrationen: 
cd backend
python manage.py makemigrations
python manage.py migrate


Umgebungsvariablen konfigurieren (.env Datei):
- Kopiere backend/.env.example nach backend/.env
- Passe die Werte an:

  # Django Settings
  SECRET_KEY=dein-sicherer-key-hier
  DJANGO_DEBUG=True
  ALLOWED_HOSTS=localhost,127.0.0.1

  # Database
  DB_NAME=verp_db
  DB_USER=verp_user
  DB_PASSWORD=verp_password
  DB_HOST=localhost
  DB_PORT=5432

  # Media Storage - Absoluter Pfad zum externen Medienordner
  MEDIA_ROOT=C:/VERP-Media

- Generiere einen sicheren SECRET_KEY:
  cd backend
  python tools/generate_secret_key.py


Medien-Speicherstruktur (VERP-Media):
Der MEDIA_ROOT Ordner enthält alle hochgeladenen und generierten Dateien:
  /customer_orders/Jahr/Auftragsnummer/    - Kundenaufträge
  /orders/Jahr/Bestellnummer/              - Lieferantenbestellungen
  /quotations/Jahr/Angebotsnummer/         - Angebote
  /Systems/Systemnummer/                   - Systeme
  /projects/Projektnummer/                 - Projekte
  /HR/Mitarbeiternummer/                   - Personal (DSGVO-geschützt)
  /Trading Goods/VS-Artikelnummer/         - Handelswaren
  /M&S/VS-Artikelnummer/                   - Material & Supplies
  /Service/Serviceticketnummer/            - Service-Tickets
  /Manufacturing/Produktnummer/            - Fertigung
  /VisiView/Lizenznummer/                  - VisiView Lizenzen
  /company/                                - Firmenlogos/Header


Superuser erstellen bei activated venv
python manage.py createsuperuser


Firmeneinstellungen konfigurieren:
1. Admin-Interface öffnen: http://localhost:8000/admin
2. Unter "Firmeneinstellungen" → "Company Settings" die Firmendaten eintragen
3. Dokument-Header hochladen (visitron_document_header.png)
4. Bankverbindung, Geschäftsführer, Handelsregister-Nr. eintragen


Bestelldokumente:
- Beim Erstellen/Bearbeiten einer Bestellung können Sie:
  * Ein Bestelldokument hochladen (z.B. PDF von Online-Bestellung)
  * Ein professionelles PDF-Bestelldokument generieren (Button "Speichern und PDF generieren")
- Das generierte PDF enthält:
  * Firmen-Logo (aus Company Settings)
  * Lieferantenadresse
  * Bestellpositionen mit allen Details
  * Footer mit Firmendaten, Bankverbindung und rechtlichen Informationen
- HINWEIS: PDFs werden nur beim Klick auf "Speichern und PDF generieren" erstellt,
  nicht bei jedem Speichervorgang.


server starten :

# Backend (Terminal 1)
cd backend
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process
.\venv\Scripts\Activate
python manage.py runserver

# Frontend (Terminal 2)
cd frontend
npm start


# Ins Backend-Verzeichnis wechseln
cd backend

# DRY-RUN (Vorschau ohne Änderungen)
python import_addresses.py

# ECHTER IMPORT (importiert ~7.500 Kunden mit Adressen, Telefonnummern, E-Mails)
python import_addresses.py --live

# Hinweis: Der Import filtert automatisch Lieferanten und veraltete Adressen aus.
# Bei identischen Namen werden mehrere Adressen dem selben Kunden zugeordnet.
# Felder die zu lang sind werden automatisch gekürzt (Stadt: 100, Straße: 200, Tel: 50 Zeichen)

cd backend
python import_visiview_licenses.py "C:\Users\mdunk\Documents\VERP\Datenvorlagen\Licenses.csv"        # Dry-run
python import_visiview_licenses.py "C:\Users\mdunk\Documents\VERP\Datenvorlagen\Licenses.csv" --live # Live-Import

cd backend
python import_visiview_macros.py --dry-run
python import_visiview_macros.py

Next steps: run a dry-run first:
python backend/delete_supplier_and_incoming.py --number 104
If output looks correct, run with --yes to perform deletion.

favicons generieren: 
cd frontend
# sicherstellen, dass frontend/public/VERP.svg vorhanden ist
npm run generate-favicons

python import_maintenance_data.py --license-id 1598


cd c:\Users\mdunk\Documents\VERP\backend
dry run
python import_legacy_orders.py --limit 100
live
python import_legacy_orders.py --live

um bei den Systemen die Kundenadresse als systemadresse zu übernehmen: 
cd backend
..\.venv\Scripts\python.exe migrate_system_locations.py

update nach Änderung
cd C:\VERP
git pull origin main
Restart-Service VERP-Backend

bzw. 
cd C:\VERP
git pull origin main

cd C:\VERP\frontend
npm run build
Copy-Item C:\VERP\scripts\web.config.template C:\VERP\frontend\build\web.config -Force
iisreset

Schritte:

DNS‑Auflösung im Netzwerk einrichten
Danach Hostname überall ohne Hosts‑Eintrag nutzbar
Der Zugriff klappt jetzt, weil du lokal hosts gesetzt hast. Für Android/andere Clients brauchst du DNS:

Option A (empfohlen): Router/DNS‑Server

Im Router oder DNS‑Server einen A‑Record anlegen:
verp.intern.local → 192.168.0.2